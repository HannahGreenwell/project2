<%# This code is just for the guesser - the correct-guess checking code, which also sends an AJAX game over message %>

<script>

  let gameOver;

  $(document).ready(function() {

    gameOver = function(result) {

      canvas.toBlob(function(blob){
        // when the blob is ready:

        const fd = new FormData();
        fd.append('drawingData', blob);

        // this is the result of the game
        fd.append('result', result);

        // ajax POST to games
        $.ajax({
          type: "POST",
          url: "<%= game_over_path(@game) %>",
          data: fd,
          processData: false,
          contentType: false
        })
        .done(function() {
          App.games.perform('game_over', {status: 'finished'});
          window.location.href = "<%= game_result_path(@game) %>";
        });
      }); // toBlob callback
    }; // gameOver

    $('.guessButton').on('click', function(){

      if (currentWord === $('.guessField').val()) {
        gameOver('won');
      } else {
        // TO DO: Let the guesser know their guess was incorrect
      }

      return false;
    }); // guessButton click handler

  });
</script>
