<%# This code is just for the guesser - the correct-guess checking code, which also sends an AJAX game over message %>

<script>

  let gameOver;

  $(document).ready(function() {

    gameOver = function(result) {

      canvas.toBlob(function(blob){
        // when the blob is ready:

        const fd = new FormData();
        fd.append('drawingData', blob);

        // this is the result of the game
        fd.append('result', result);

        // ajax POST to games
        $.ajax({
          type: "POST",
          url: "<%= game_over_path(@game) %>",
          data: fd,
          processData: false,
          contentType: false
        })
        .done(App.games.perform('game_over', {status: 'finished'})
        .fail(console.warn));
      }); // canvas.toBlob
    }; // gameOver

    $('.guessButton').on('click', function() {
      const currentGuess = $('.guessField').val().toLowerCase();

      if (currentWord === currentGuess) {
        $('.guessButton').css({
          border: 'solid 2px #999',
          color: '#999',
          pointerEvents: 'none'
        });

        $('.guessField').css({border: 'solid 2px green', color: 'green'}).val('CORRECT!');

        gameOver('won');
      } else {
        $('.guessField').css({border: 'solid 2px red', color: 'red'}).val('Try Again');
      }

      return false;
    }); // guessButton click handler

    $('.guessField').on('focus', function() {
      $(this).val('').css({border: 'solid 2px #999', color: 'black'})
    })

  });
</script>
